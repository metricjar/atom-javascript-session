!function(s,e,t){"use strict";function i(e){this.TAG="ISA-Session";var t="1.2.0",i="atom-js-session";if(this.STORAGE_PREFIX="ATOM_SESSION_",this.SESSION_KEY="SESSION_ID",this.SESSION_LAST_ACTIVE="SESSION_LAST_ACTIVE",this.USER_ID="USER_ID",e=e||{},this.userID=e.userID,this.sessionID=e.sessionID,this.sessionLastActive=e.sessionLastActive||Date.now(),this.isDebug=e.debug||!1,!s.IronSourceAtom)throw new Error("Please include the ironSource Atom SDK in order to use the session sdk");e.sdkVersion=t,e.sdkType=i,this.tracker_=new IronSourceAtom.Tracker(e),this.sessionLifeTime=e.sessionLifeTime?e.sessionLifeTime:18e5,this.userID&&(S(this.TAG,"Custom UserID added: "+this.userID,this.isDebug),localStorage.setItem(this.STORAGE_PREFIX+this.USER_ID,this.userID)),this.sessionID&&(S(this.TAG,"Custom Session added: "+this.sessionID,this.isDebug),S(this.TAG,"Custom Session last active: "+this.sessionLastActive,this.isDebug),localStorage.setItem(this.STORAGE_PREFIX+this.SESSION_KEY,this.sessionID),localStorage.setItem(this.STORAGE_PREFIX+this.SESSION_LAST_ACTIVE,this.sessionLastActive))}function o(s){for(var e=s?s:32,t="",i=0;i<e;i++)switch(i){case 8:case 20:t+=(16*Math.random()|0).toString(16);break;case 16:t+=(4*Math.random()|8).toString(16);break;default:t+=(16*Math.random()|0).toString(16)}return t}function S(s,e,t){t&&console.log(s+": "+e)}s.IronSourceAtomSession=i,i.prototype.track=function(s,e){var t=this,i={};if("string"==typeof e||e instanceof String)try{i=JSON.parse(e)}catch(s){throw new Error("Invalid JSON String - can't be converted to Object, "+s)}else i=e;i.ib_sessionid=t._getSessionID(),i.ib_userid=t._getUserID(),t.tracker_.track(s,i)},i.prototype._getSessionID=function(){var s=this,e=localStorage.getItem(s.STORAGE_PREFIX+s.SESSION_KEY),t=localStorage.getItem(s.STORAGE_PREFIX+s.SESSION_LAST_ACTIVE),i=Date.now();return S(s.TAG,"Got SessionID from storage: "+e,s.isDebug),S(s.TAG,"Got SessionLastActive from storage: "+t,s.isDebug),S(s.TAG,"Got SessionLifeTime from storage: "+s.sessionLifeTime,s.isDebug),!e||i-t>=s.sessionLifeTime?(e=o(),localStorage.setItem(s.STORAGE_PREFIX+s.SESSION_KEY,e),localStorage.setItem(s.STORAGE_PREFIX+s.SESSION_LAST_ACTIVE,i),S(s.TAG,"Session ID updated: "+e,s.isDebug),S(s.TAG,"Session Last Active updated: "+i,s.isDebug),e):(localStorage.setItem(s.STORAGE_PREFIX+s.SESSION_LAST_ACTIVE,i),e)},i.prototype._getUserID=function(){var s=this,e=localStorage.getItem(s.STORAGE_PREFIX+s.USER_ID);return S(s.TAG,"Got UserID from storage: "+e,s.isDebug),e?S(s.TAG,"Using UserID: "+e,s.isDebug):(e=o(),localStorage.setItem(s.STORAGE_PREFIX+s.USER_ID,e),S(s.TAG,"New UserID: "+e,s.isDebug)),e},i.prototype.flush=function(s,e){this.tracker_.flush(s,e)},"undefined"!=typeof module&&module.exports&&(module.exports={Session:i})}(window,document);